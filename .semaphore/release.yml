version: v1.0
name: Release Paprika
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
blocks:
  - name: "üç≥ Release"
    task:
      secrets:
        - name: github-ssh
        - name: paprika-env
      prologue:
        commands:
          - checkout
          - cache restore client-node-modules-$SEMAPHORE_GIT_BRANCH-$(checksum yarn.lock),client-node-modules-$SEMAPHORE_GIT_BRANCH,client-node-modules-master
      jobs:
        - name: "Publish to NPM"
          commands:
            - nvm use
            - npx lerna bootstrap
            - yarn
            - yarn lerna version prerelease --yes
            - yarn lerna publish from-package --yes
