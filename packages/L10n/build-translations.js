const fs = require("fs");
const jsYaml = require("js-yaml");

const path = "src";
const yamlsPath = `${path}/locales`;
const translationsPath = `${path}/locales-js`;
const yamlExtension = "yml";

const removeTranslationFiles = () => {
  fs.readdir(translationsPath, (err, files) => {
    if (err) {
      return console.error("Couldnt scan directory");
    }

    files.forEach(file => {
      fs.unlinkSync(`${translationsPath}/${file}`);
    });
  });
};

console.log("🦁 Preparing L10n Locales");
const isYamlFile = file => file.split(".")[1] === yamlExtension;

const createTranslationFile = yamlFileName => {
  const outputFileName = yamlFileName.replace(`.${yamlExtension}`, ".js");
  const yamlAsJsonObject = jsYaml.load(fs.readFileSync(`${yamlsPath}/${yamlFileName}`, { encoding: "utf-8" }));
  const outputFileContents = `// Do not edit this file, it is automatically generated
const locales = ${JSON.stringify(yamlAsJsonObject, null, 2)};
export default locales;`;

  fs.writeFile(`${translationsPath}/${outputFileName}`, outputFileContents, () => {});
};

const generateTranslationFiles = () => {
  fs.readdir(yamlsPath, (err, files) => {
    if (err) {
      console.log(err);
      console.error("Couldn't scan directory");
      process.exit(1);
    }

    files.forEach(file => {
      if (isYamlFile(file)) {
        createTranslationFile(file);
      }
    });
  });
};

removeTranslationFiles();
generateTranslationFiles();
